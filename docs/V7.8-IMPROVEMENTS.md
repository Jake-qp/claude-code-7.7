# Claude Code V7.8 Improvements Required

**Generated:** December 24, 2024
**Source:** V7.7 System Test Part 2 Audit

---

## Executive Summary

The V7.7 system test revealed **15 issues** requiring fixes for V7.8:

- **4 CRITICAL** - System failures that prevent expected behavior
- **5 HIGH** - Significant gaps that cause manual workarounds
- **4 MEDIUM** - Coordination issues between components
- **2 LOW** - Minor enhancements

---

## CRITICAL Issues (Blockers)

### 1. DevOps Skill Creates Failing CI Pipeline

**Problem:** DevOps skill generates `.github/workflows/ci.yml` that fails immediately when pushed because it assumes prerequisites that don't exist.

**Root Cause:** CI workflow references:

- `npm run lint` → No `.eslintrc.json` exists
- `npm test` → Jest picks up Playwright tests
- `npm run build` → No Next.js app structure exists

**Required Fix for V7.8:**

```
DevOps skill MUST either:
A) Verify prerequisites exist before generating CI jobs
B) Generate missing configs alongside CI workflow
C) Skip jobs for missing prerequisites with TODO comments
```

**Files to modify:** `.claude/skills/devops/SKILL.md`

---

### 2. Testing Skill Doesn't Coordinate with Jest Config

**Problem:** When testing skill sets up Playwright E2E tests, Jest still tries to run them, causing failures.

**Root Cause:** Testing skill creates `e2e/` directory but doesn't update `jest.config.js` to exclude it.

**Required Fix for V7.8:**

```
Testing skill MUST:
- Add e2e/ to jest.config.js testPathIgnorePatterns
- OR create separate jest.config.js and jest.e2e.config.js
```

**Files to modify:** `.claude/skills/testing/SKILL.md`

---

### 3. SlashCommand Tool Returns "Invalid tool name format"

**Problem:** Using `/fix` command via SlashCommand tool returns error, requiring manual workflow execution.

**Evidence:**

```
SlashCommand tool "Invalid tool name format" when trying to use `/fix` command
Fixed by manually executing the /fix workflow
```

**Required Fix for V7.8:**

```
Investigate and fix SlashCommand tool parsing
- May be issue with command format
- May be issue with tool registration
```

**Files to modify:** Tool implementation (outside skill system)

---

### 4. Skills Not Invoked via Skill Tool

**Problem:** During testing, skills were manually followed rather than loaded via the Skill tool. This means the skill loading mechanism wasn't actually tested.

**Evidence:** No `Skill tool` invocations in test logs. Tester manually read SKILL.md files and followed instructions.

**Required Fix for V7.8:**

```
System test protocol MUST require:
- Explicit Skill tool invocation for each skill test
- Verification that skill prompt is expanded
- Confirmation skill guidance is followed
```

**Impact:** Unknown if Skill tool actually works correctly.

---

## HIGH Priority Issues

### 5. Missing Document Generation

**Problem:** Several documents that should be auto-generated were never created.

| Document                     | Trigger        | Status     |
| ---------------------------- | -------------- | ---------- |
| ARCHITECTURE.md              | First /build   | ❌ Missing |
| .env.example                 | First /build   | ❌ Missing |
| docs/API-CONTRACTS.md        | Backend skill  | ❌ Missing |
| docs/DATA-MODELS.md          | Database skill | ❌ Missing |
| docs/AUTH-FLOWS.md           | Security skill | ❌ Missing |
| docs/SECURITY.md             | Security skill | ❌ Missing |
| docs/PRODUCTION-CHECKLIST.md | /launch        | ❌ Missing |

**Required Fix for V7.8:**

```
Skills MUST generate their documented outputs.
Add verification step to confirm document creation.
```

---

### 6. Hooks Not Systematically Tested

**Problem:** 6 hooks exist but only checkpoint.sh was incidentally tested (via stop hook).

| Hook             | Tested | Status           |
| ---------------- | ------ | ---------------- |
| session-start.sh | ❌     | Unknown if works |
| pre-tool.sh      | ❌     | Unknown if works |
| protect-files.sh | ❌     | Unknown if works |
| format.sh        | ❌     | Unknown if works |
| checkpoint.sh    | ⚠️     | Stop hook worked |
| notify.sh        | ❌     | Unknown if works |

**Required Fix for V7.8:**

```
System test MUST include hook verification:
- session-start: Verify status shown on start
- pre-tool: Verify tests run before commit
- protect-files: Try to edit .env, verify blocked
- format: Make unformatted change, verify auto-format
- checkpoint: Verify auto-save on stop
- notify: Verify desktop notification sent
```

---

### 7. Brainstorm Skill User Answers Were Simulated

**Problem:** In Test 2, "user answers" (A, D, etc.) were simulated by the tester rather than actual user input. The test was self-fulfilling.

**Evidence:**

```
_User answer: D) All of the above_
_User answer: A) Business owners_
_User answer: A) Usage metrics only_
```

These were not real user interactions.

**Required Fix for V7.8:**

```
Brainstorm skill test MUST:
- Actually pause for user input
- Document real user responses
- OR clearly mark simulated tests as such
```

---

### 8. Implementation Plan Tasks Never Executed

**Problem:** A 6-task implementation plan was generated but never actually executed.

**Evidence:** SCRATCHPAD.md contains:

```
Task 1: Create usage metrics API types (~5 min)
Task 2: Write tests for usage metrics hook (~10 min)
...
Task 6: Add Plausible event tracking (~10 min)
Total estimated time: ~50 min
```

None of these tasks were completed.

**Required Fix for V7.8:**

```
Implementation-plan skill MUST:
- Either execute the plan after generation
- OR clearly document it as "plan only, not execution"
```

---

### 9. Mobile App Not Verified to Build

**Problem:** React Native app structure was created but never verified to actually build or run.

**Evidence:** `mobile/` directory created with Expo files, but no `npm install` or `expo start` was run.

**Required Fix for V7.8:**

```
Mobile skill MUST verify:
- npm install succeeds
- expo start launches without errors
- OR document as "scaffold only"
```

---

## MEDIUM Priority Issues

### 10. Researcher Agent Invocation Unclear

**Problem:** Test 3 claims to use "Researcher Agent" but it's unclear if Task tool was used with proper subagent_type or if WebSearch/WebFetch were called directly.

**SCRATCHPAD says:** "via Researcher Agent + WebSearch/WebFetch"

**Required Fix for V7.8:**

```
Researcher agent test MUST:
- Show explicit Task tool invocation
- Show subagent_type parameter
- Verify agent returns structured output
```

---

### 11. Explorer Agent Output Not Verified Against Spec

**Problem:** Explorer agent returned investigation report, but it wasn't verified against the documented spec (< 2000 tokens, structured output, etc.).

**Required Fix for V7.8:**

```
Agent tests MUST verify:
- Token count within limits
- Output format matches spec
- Tools used match documentation
```

---

### 12. Iron Law Compliance Gaps

**Problem:** Iron Law 1 ("No production code without failing test first") was marked "N/A" for design phase, but this exception isn't documented.

**Evidence:**

```
| No production code without failing test first | N/A (design phase) |
```

**Required Fix for V7.8:**

```
Document when Iron Laws apply:
- Law 1: Applies to implementation, not design
- Law 2: Applies to bug fixes
- Law 3: Applies to all completion claims
```

---

### 13. Verification Skill Not Explicitly Tested

**Problem:** Verification skill is listed as "PASS" but was never explicitly invoked. Verification happened ad-hoc during other tests.

**Required Fix for V7.8:**

```
Verification skill test MUST:
- Explicitly invoke verification skill
- Show verification checklist execution
- Document fresh evidence gathered
```

---

## LOW Priority Issues

### 14. jest-environment-jsdom Missing

**Problem:** Tests failed initially because `jest-environment-jsdom` wasn't installed.

**Required Fix for V7.8:**

```
Project initialization MUST include all test dependencies.
Add to testing skill setup steps.
```

---

### 15. Checkpoint Hook Timestamp Format

**Problem:** Multiple checkpoint timestamps in SCRATCHPAD.md but format is inconsistent with session continuity.

**Required Fix for V7.8:**

```
Checkpoint hook should:
- Use consistent timestamp format
- Include session ID
- Link to git commit if available
```

---

## Test Protocol Improvements for V7.8

### Before Testing

1. **Fresh environment** - Start from clean state
2. **Document baseline** - Record existing files/state
3. **Verify tools** - Test Skill, Task, SlashCommand tools work

### During Testing

1. **Explicit invocations** - Use actual tools, not manual workarounds
2. **Real user input** - Don't simulate user responses
3. **Verify outputs** - Check generated files exist and match spec
4. **Test hooks** - Trigger each hook and verify behavior

### After Testing

1. **Verify CI passes** - Push and confirm GitHub Actions green
2. **Check all documents** - Every template should have generated file
3. **Audit logs** - Review tool invocations vs manual actions

---

## Summary Table

| Issue                         | Severity | Component       | V7.8 Action                |
| ----------------------------- | -------- | --------------- | -------------------------- |
| CI fails on push              | CRITICAL | DevOps skill    | Add prerequisite checks    |
| Jest runs Playwright          | CRITICAL | Testing skill   | Add e2e to ignore          |
| SlashCommand broken           | CRITICAL | Tool            | Investigate and fix        |
| Skills not loaded via tool    | CRITICAL | Test protocol   | Require Skill tool usage   |
| Missing documents             | HIGH     | Multiple skills | Verify document generation |
| Hooks not tested              | HIGH     | Test protocol   | Add hook verification      |
| Simulated user answers        | HIGH     | Brainstorm test | Require real input         |
| Plan not executed             | HIGH     | Impl-plan test  | Execute or document        |
| Mobile not verified           | HIGH     | Mobile skill    | Add build verification     |
| Researcher invocation unclear | MEDIUM   | Test docs       | Show tool calls            |
| Explorer output not verified  | MEDIUM   | Test docs       | Verify against spec        |
| Iron Law exceptions           | MEDIUM   | Documentation   | Document when applies      |
| Verification not explicit     | MEDIUM   | Test protocol   | Explicit invocation        |
| jest-environment-jsdom        | LOW      | Setup           | Add to dependencies        |
| Checkpoint format             | LOW      | Hook            | Standardize format         |

---

## Files to Modify for V7.8

### Skills

- `.claude/skills/devops/SKILL.md` - Add CI prerequisite checks
- `.claude/skills/testing/SKILL.md` - Add Jest/Playwright separation
- `.claude/skills/mobile/SKILL.md` - Add build verification
- `.claude/skills/verification/SKILL.md` - Clarify invocation

### Documentation

- `CLAUDE.md` - Document Iron Law exceptions
- Test protocol documentation (new)

### Templates

- Hook verification template (new)
- Skill test template (new)

---

_This document should be used as the specification for V7.8 improvements._
