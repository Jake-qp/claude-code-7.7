# Monitoring Guide

> Generated by Claude Code V7.7 - DevOps Skill

## Dashboards

| Dashboard        | URL                                  | Purpose                          |
| ---------------- | ------------------------------------ | -------------------------------- |
| Vercel Analytics | vercel.com/[org]/[project]/analytics | Request metrics, Core Web Vitals |
| Plausible        | plausible.io/billing.example.com     | User analytics, page views       |
| Stripe Dashboard | dashboard.stripe.com                 | Payment metrics, revenue         |
| Error Tracking   | sentry.io/[org]/billing              | Errors, exceptions               |

## Key Metrics

### Application

| Metric            | Warning | Critical | Source           |
| ----------------- | ------- | -------- | ---------------- |
| Response time p95 | > 500ms | > 2000ms | Vercel Analytics |
| Error rate        | > 1%    | > 5%     | Sentry           |
| Request rate drop | > 20%   | > 50%    | Vercel Analytics |
| 5xx responses     | > 0.5%  | > 2%     | Vercel Logs      |

### Core Web Vitals

| Metric | Good    | Needs Work | Poor    |
| ------ | ------- | ---------- | ------- |
| LCP    | < 2.5s  | 2.5-4s     | > 4s    |
| FID    | < 100ms | 100-300ms  | > 300ms |
| CLS    | < 0.1   | 0.1-0.25   | > 0.25  |

### Infrastructure

| Metric            | Warning | Critical | Source           |
| ----------------- | ------- | -------- | ---------------- |
| CPU usage         | > 70%   | > 90%    | Hosting provider |
| Memory usage      | > 80%   | > 95%    | Hosting provider |
| Function duration | > 5s    | > 10s    | Vercel           |
| Cold starts       | > 20%   | > 40%    | Vercel           |

### Database

| Metric                | Warning | Critical | Source            |
| --------------------- | ------- | -------- | ----------------- |
| Query time p95        | > 100ms | > 500ms  | Database provider |
| Connection pool usage | > 70%   | > 90%    | Database provider |
| Storage usage         | > 70%   | > 90%    | Database provider |
| Active connections    | > 15    | > 20     | Database provider |

### Business Metrics

| Metric               | Warning     | Critical | Source |
| -------------------- | ----------- | -------- | ------ |
| Successful checkouts | < 95%       | < 90%    | Stripe |
| Webhook failures     | > 1%        | > 5%     | Stripe |
| Active subscriptions | Sudden drop | -        | Stripe |

## Alerts

| Alert                  | Condition             | Action       | Channel   |
| ---------------------- | --------------------- | ------------ | --------- |
| Site Down              | Health check fails 3x | Page on-call | PagerDuty |
| High Error Rate        | > 5% for 5 min        | Page on-call | PagerDuty |
| Slow Responses         | p95 > 2s for 10 min   | Notify team  | Slack     |
| High Function Duration | > 10s avg for 5 min   | Investigate  | Slack     |
| Payment Failures       | > 10% for 15 min      | Notify team  | Slack     |
| Database Connection    | Pool > 90% for 5 min  | Investigate  | Slack     |

## Log Locations

| Service      | Location                        | Retention                   |
| ------------ | ------------------------------- | --------------------------- |
| Application  | Vercel Dashboard → Logs         | 1 hour (free), 3 days (pro) |
| Build/Deploy | Vercel Dashboard → Deployments  | Permanent                   |
| Database     | Provider dashboard              | Varies                      |
| Errors       | Sentry → Issues                 | 90 days                     |
| Analytics    | Plausible → billing.example.com | Unlimited                   |

## Error Tracking Setup

**Service:** Sentry (recommended)

### Installation

```bash
npm install @sentry/nextjs
npx @sentry/wizard -i nextjs
```

### Configuration

```typescript
// sentry.client.config.ts
import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  tracesSampleRate: 0.1, // 10% of requests
  environment: process.env.NODE_ENV,
});
```

### Required Environment Variables

```bash
SENTRY_DSN=https://xxx@sentry.io/xxx
SENTRY_ORG=your-org
SENTRY_PROJECT=billing-dashboard
```

## On-Call Procedures

### 1. Alert Received

- Acknowledge alert within response time (15 min for critical)
- Note start time for incident duration tracking

### 2. Assess Situation

- Check health endpoint: `curl https://billing.example.com/api/health`
- Check error tracking for related errors
- Check recent deployments: `vercel ls`

### 3. Triage

| Severity             | Action                          |
| -------------------- | ------------------------------- |
| Site completely down | Rollback immediately            |
| Feature broken       | Investigate, rollback if needed |
| Degraded performance | Monitor, schedule fix           |

### 4. Resolve

- Apply fix or rollback
- Verify resolution with health check
- Monitor for recurrence

### 5. Document

- Create incident report
- Update runbook if new issue type
- Schedule post-mortem if critical

## Incident Response Template

```markdown
## Incident: [TITLE]

**Severity:** Critical / High / Medium / Low
**Duration:** [Start Time] - [End Time]
**Impact:** [Number of users affected, revenue lost]

### Timeline

- HH:MM - Alert received
- HH:MM - Investigation started
- HH:MM - Root cause identified
- HH:MM - Fix applied
- HH:MM - Resolution confirmed

### Root Cause

[Description of what caused the incident]

### Resolution

[What was done to fix it]

### Prevention

[What will be done to prevent recurrence]

### Action Items

- [ ] [Action 1]
- [ ] [Action 2]
```

---

_Last updated: 2024-12-23_
